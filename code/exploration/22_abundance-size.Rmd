---
title: "Abundance ~ species size?"
author: "Eleanor Jackson"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: 
  github_document:
    keep_html: false
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.path="figures/22_abundance-size/")
```

```{r, warning=FALSE, message=FALSE}
library("tidyverse"); theme_set(theme_bw(base_size = 10))
library("patchwork")
library("here")
```

Sofia:
 > BTW, do you think abundance will covary with tree size/growth form? I suspect it will (large canopy trees would have much higher basal area per individual)? I have been wondering if we might be more likely to see stronger CNDD in smaller trees (understory trees) than canopy trees, but if tree growth form and summed basal area covary then the current results suggest that would not be the case. 
 
```{r}
R50 <- read.csv(here::here("data", "clean", "R50.csv"))
```
 
 
## Get abundance data

```{r}
tree_data <- 
  readRDS(here::here("data", "clean", "tree_data.rds")) %>% 
  filter(year %in% c("1990", "1995", "2000", "2005", "2010",
                     "2010", "2015", "2022"))
```

```{r}
# brms::parnames(model)
abun <- 
  tree_data %>% 
  group_by(year, sp4, sp6, genus, species) %>% 
  summarise(abundance = sum(basal_area_m2, na.rm = TRUE)) %>% 
  group_by(sp4, sp6, genus, species) %>% 
  summarise(median_abundance = median(abundance, na.rm = TRUE),
            mean_abundance = mean(abundance, na.rm = TRUE),
            max_abundance = max(abundance, na.rm = TRUE))

```

```{r}
  abun %>% 
  inner_join(R50) %>% 
  left_join(read_csv(here::here("data", "clean", "species_list.csv"))) %>% 
  ggplot(aes(x = log(median_abundance), y = dmax,
             colour = lifeform)) +
  geom_point()  
```

